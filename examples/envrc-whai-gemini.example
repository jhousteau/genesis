# 🔒 GCP Per-Repo Isolation Configuration
# This repo uses its own gcloud config directory to prevent cross-contamination
# Generated by setup-gcp-isolation-universal.sh

# ==== Core Variables ====
export PROJECT_ID="whai-gemini-dev"
export REGION="us-central1"
export ZONE="us-central1-a"
export ENVIRONMENT="dev"

# ==== Per-Repo Gcloud Isolation ====
# This repo's private gcloud config directory
export REPO_GCLOUD_HOME="/Users/jameshousteau/.gcloud/whai-gemini-dev"
export CLOUDSDK_CONFIG="${REPO_GCLOUD_HOME}"

# Name of the config inside this directory
export CLOUDSDK_ACTIVE_CONFIG_NAME="default"

# ==== Service Account Impersonation (Recommended) ====
# Safer than local keys - impersonate a minimal-deploy SA per env
export DEPLOY_SA="deploy-dev@whai-gemini-dev.iam.gserviceaccount.com"
export GCLOUD_IMPERSONATE_SA="${DEPLOY_SA}"

# ==== Application Default Credentials (if needed) ====
# Keep credentials repository-local to prevent cross-project access
# export GOOGLE_APPLICATION_CREDENTIALS="$PWD/.secrets/${PROJECT_ID}-adc.json"

# ==== Production Safety ====
# Block prod operations unless explicitly confirmed
if [[ "${PROJECT_ID}" =~ (^|-)prod(-|$) ]] || [[ "${ENVIRONMENT}" == "prod" ]]; then
    echo "⚠️  WARNING: Production environment detected: ${ENVIRONMENT} (${PROJECT_ID})"
    echo "   Set CONFIRM_PROD=I_UNDERSTAND to enable production operations"
    # export CONFIRM_PROD="I_UNDERSTAND"  # Uncomment only when needed
fi

# ==== Auto-Bootstrap ====
# Run bootstrap on first entry to this directory
if [[ -f "scripts/bootstrap_gcloud.sh" ]] && [[ ! -d "${REPO_GCLOUD_HOME}" ]]; then
    echo "🔒 First time setup detected. Running GCP isolation bootstrap..."
    ./scripts/bootstrap_gcloud.sh
fi

# ==== Development Environment ====
# Add project scripts to PATH
export PATH="$PWD/scripts:$PATH"

# Python virtual environment (if applicable)
if [[ -d ".venv" ]]; then
    source .venv/bin/activate
fi

# Node.js local binaries (if applicable)
if [[ -d "node_modules/.bin" ]]; then
    export PATH="$PWD/node_modules/.bin:$PATH"
fi

# Show current context
echo "════════════════════════════════════════════"
echo "📁 Project: whai-gemini"
echo "🌍 Environment: ${ENVIRONMENT}"
echo "☁️  GCP Project: ${PROJECT_ID}"
echo "📍 Region: ${REGION}"
echo "🔒 Config: ${CLOUDSDK_CONFIG}"
echo "🔐 SA: ${GCLOUD_IMPERSONATE_SA}"
echo "════════════════════════════════════════════"
