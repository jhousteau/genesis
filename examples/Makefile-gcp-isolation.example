# ðŸ”’ GCP-Isolated Makefile
# Standard targets that use repo-scoped gcloud configuration

REGION ?= $(shell gcloud config get-value compute/region 2>/dev/null)
PROJECT_ID ?= $(shell gcloud config get-value core/project 2>/dev/null)

.PHONY: preflight whoami deploy logs self-check bootstrap

# Verify gcloud configuration before any operations
preflight:
	@./isolation/gcp/scripts/gcloud_guard.sh config list --format="table(name,is_active,account,project)" >/dev/null
	@echo "âœ… Preflight check passed"

# Show current authentication and project
whoami: preflight
	@echo "Current gcloud context:"
	@./isolation/gcp/scripts/gcloud_guard.sh auth list --format="table(account,status)"
	@echo "Project: $(PROJECT_ID)"
	@echo "Region: $(REGION)"

# Verify repo isolation setup
self-check:
	@./isolation/gcp/scripts/self_check.sh

# Bootstrap gcloud configuration
bootstrap:
	@./isolation/gcp/scripts/bootstrap_gcloud.sh

# Example deployment target (customize for your project)
deploy: preflight
	@echo "ðŸš€ Deploying to $(PROJECT_ID) in $(REGION)"
	@echo "Add your deployment commands here, using ./scripts/gcloud_guard.sh"
	# Example:
	# ./isolation/gcp/scripts/gcloud_guard.sh run deploy my-service \
	#   --region=$(REGION) --quiet

# View service logs (example)
logs: preflight
	@echo "ðŸ“‹ Recent logs for $(PROJECT_ID)"
	# Example:
	# ./isolation/gcp/scripts/gcloud_guard.sh logging read --limit=50 --format=json

# Help target
help:
	@echo "Available targets:"
	@echo "  preflight   - Verify gcloud configuration"
	@echo "  whoami      - Show current authentication"
	@echo "  self-check  - Verify repo isolation setup"
	@echo "  bootstrap   - Initialize gcloud configuration"
	@echo "  deploy      - Deploy to current environment"
	@echo "  logs        - View service logs"
	@echo "  help        - Show this help"
