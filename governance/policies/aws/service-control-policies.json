{
  "policies": {
    "DenyRootAccess": {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Sid": "DenyRootUserAccess",
          "Effect": "Deny",
          "Principal": {
            "AWS": "*"
          },
          "Action": "*",
          "Resource": "*",
          "Condition": {
            "StringEquals": {
              "aws:PrincipalType": "Root"
            }
          }
        }
      ]
    },
    
    "EnforceEncryption": {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Sid": "DenyUnencryptedS3Upload",
          "Effect": "Deny",
          "Action": [
            "s3:PutObject"
          ],
          "Resource": "*",
          "Condition": {
            "StringNotEquals": {
              "s3:x-amz-server-side-encryption": [
                "AES256",
                "aws:kms"
              ]
            }
          }
        },
        {
          "Sid": "DenyUnencryptedEBSCreation",
          "Effect": "Deny",
          "Action": [
            "ec2:CreateVolume"
          ],
          "Resource": "*",
          "Condition": {
            "Bool": {
              "ec2:Encrypted": "false"
            }
          }
        }
      ]
    },
    
    "RestrictRegions": {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Sid": "RestrictToAllowedRegions",
          "Effect": "Deny",
          "Action": "*",
          "Resource": "*",
          "Condition": {
            "StringNotEquals": {
              "aws:RequestedRegion": [
                "us-east-1",
                "us-west-2",
                "eu-west-1"
              ]
            },
            "ForAllValues:StringNotEquals": {
              "aws:PrincipalServiceName": [
                "cloudformation.amazonaws.com",
                "organizations.amazonaws.com"
              ]
            }
          }
        }
      ]
    },
    
    "RequireMFA": {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Sid": "RequireMFAForHighRiskActions",
          "Effect": "Deny",
          "Action": [
            "iam:DeleteRole",
            "iam:DeleteUser",
            "iam:DeletePolicy",
            "ec2:TerminateInstances",
            "rds:DeleteDBInstance",
            "s3:DeleteBucket"
          ],
          "Resource": "*",
          "Condition": {
            "Bool": {
              "aws:MultiFactorAuthPresent": "false"
            }
          }
        }
      ]
    },
    
    "PreventPrivilegeEscalation": {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Sid": "PreventIAMPrivilegeEscalation",
          "Effect": "Deny",
          "Action": [
            "iam:CreateRole",
            "iam:AttachRolePolicy",
            "iam:DetachRolePolicy",
            "iam:PutRolePolicy",
            "iam:CreateUser",
            "iam:AttachUserPolicy",
            "iam:DetachUserPolicy",
            "iam:PutUserPolicy"
          ],
          "Resource": "*",
          "Condition": {
            "StringNotEquals": {
              "aws:PrincipalServiceName": [
                "cloudformation.amazonaws.com",
                "terraform.amazonaws.com"
              ]
            }
          }
        }
      ]
    },
    
    "RequireResourceTags": {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Sid": "RequireProjectTag",
          "Effect": "Deny",
          "Action": [
            "ec2:RunInstances",
            "ec2:CreateVolume",
            "rds:CreateDBInstance",
            "s3:CreateBucket"
          ],
          "Resource": "*",
          "Condition": {
            "Null": {
              "aws:RequestedTags/Project": "true"
            }
          }
        },
        {
          "Sid": "RequireEnvironmentTag",
          "Effect": "Deny",
          "Action": [
            "ec2:RunInstances",
            "ec2:CreateVolume",
            "rds:CreateDBInstance",
            "s3:CreateBucket"
          ],
          "Resource": "*",
          "Condition": {
            "Null": {
              "aws:RequestedTags/Environment": "true"
            }
          }
        },
        {
          "Sid": "RequireOwnerTag",
          "Effect": "Deny",
          "Action": [
            "ec2:RunInstances",
            "ec2:CreateVolume",
            "rds:CreateDBInstance",
            "s3:CreateBucket"
          ],
          "Resource": "*",
          "Condition": {
            "Null": {
              "aws:RequestedTags/Owner": "true"
            }
          }
        }
      ]
    },
    
    "RestrictInstanceTypes": {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Sid": "RestrictEC2InstanceTypes",
          "Effect": "Deny",
          "Action": "ec2:RunInstances",
          "Resource": "arn:aws:ec2:*:*:instance/*",
          "Condition": {
            "StringNotEquals": {
              "ec2:InstanceType": [
                "t3.micro",
                "t3.small",
                "t3.medium",
                "t3.large",
                "m5.large",
                "m5.xlarge",
                "c5.large",
                "c5.xlarge"
              ]
            }
          }
        }
      ]
    },
    
    "PreventPublicAccess": {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Sid": "PreventPublicS3Access",
          "Effect": "Deny",
          "Action": [
            "s3:PutBucketPublicAccessBlock",
            "s3:PutBucketAcl",
            "s3:PutObjectAcl"
          ],
          "Resource": "*",
          "Condition": {
            "Bool": {
              "s3:BlockPublicAccessBlock": "false"
            }
          }
        },
        {
          "Sid": "PreventPublicRDSAccess",
          "Effect": "Deny",
          "Action": [
            "rds:ModifyDBInstance"
          ],
          "Resource": "*",
          "Condition": {
            "Bool": {
              "rds:db-instance-publicly-accessible": "true"
            }
          }
        }
      ]
    },
    
    "RequireSecureTransport": {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Sid": "RequireSSLForS3",
          "Effect": "Deny",
          "Action": "s3:*",
          "Resource": "*",
          "Condition": {
            "Bool": {
              "aws:SecureTransport": "false"
            }
          }
        }
      ]
    },
    
    "CostControl": {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Sid": "PreventExpensiveResources",
          "Effect": "Deny",
          "Action": [
            "ec2:RunInstances"
          ],
          "Resource": "*",
          "Condition": {
            "StringEquals": {
              "ec2:InstanceType": [
                "p3.8xlarge",
                "p3.16xlarge",
                "x1.32xlarge",
                "r5.24xlarge"
              ]
            }
          }
        }
      ]
    }
  },
  
  "policy_sets": {
    "production": [
      "DenyRootAccess",
      "EnforceEncryption",
      "RestrictRegions",
      "RequireMFA",
      "PreventPrivilegeEscalation",
      "RequireResourceTags",
      "RestrictInstanceTypes",
      "PreventPublicAccess",
      "RequireSecureTransport",
      "CostControl"
    ],
    "development": [
      "DenyRootAccess",
      "EnforceEncryption",
      "RestrictRegions",
      "RequireResourceTags",
      "PreventPublicAccess",
      "RequireSecureTransport"
    ],
    "sandbox": [
      "DenyRootAccess",
      "RequireResourceTags"
    ]
  }
}