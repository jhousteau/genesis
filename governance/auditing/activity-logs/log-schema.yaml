# Universal Audit Log Schema
# Standardized logging format for all audit events across the platform

audit_log_schema:
  version: "1.0.0"
  format: "JSON"
  encoding: "UTF-8"
  
  # Common Event Structure
  common_fields:
    required:
      - name: "timestamp"
        type: "datetime"
        format: "ISO8601"
        description: "Event occurrence time in UTC"
        example: "2024-08-20T14:30:45.123Z"
        
      - name: "event_id"
        type: "string"
        format: "UUID"
        description: "Unique event identifier"
        example: "550e8400-e29b-41d4-a716-446655440000"
        
      - name: "event_type"
        type: "string"
        enum: ["authentication", "authorization", "data_access", "data_modification", "system_admin", "infrastructure", "security", "compliance"]
        description: "High-level event category"
        
      - name: "event_action"
        type: "string"
        description: "Specific action performed"
        example: "user_login_success"
        
      - name: "actor"
        type: "object"
        description: "Entity that performed the action"
        properties:
          user_id:
            type: "string"
            description: "User identifier"
          user_email:
            type: "string"
            format: "email"
            description: "User email address"
          user_type:
            type: "string"
            enum: ["human", "service_account", "system"]
            description: "Type of actor"
          session_id:
            type: "string"
            description: "Session identifier"
            
      - name: "resource"
        type: "object"
        description: "Resource being acted upon"
        properties:
          resource_type:
            type: "string"
            description: "Type of resource"
          resource_id:
            type: "string"
            description: "Resource identifier"
          resource_name:
            type: "string"
            description: "Human-readable resource name"
            
      - name: "source"
        type: "object"
        description: "Source of the event"
        properties:
          ip_address:
            type: "string"
            format: "ipv4|ipv6"
            description: "Source IP address"
          user_agent:
            type: "string"
            description: "User agent string"
          application:
            type: "string"
            description: "Source application or service"
          environment:
            type: "string"
            enum: ["dev", "test", "staging", "prod"]
            description: "Environment where event occurred"
            
      - name: "outcome"
        type: "string"
        enum: ["success", "failure", "partial", "unknown"]
        description: "Event outcome"
        
      - name: "severity"
        type: "string"
        enum: ["critical", "high", "medium", "low", "info"]
        description: "Event severity level"
        
    optional:
      - name: "correlation_id"
        type: "string"
        description: "ID to correlate related events"
        
      - name: "parent_event_id"
        type: "string"
        description: "Parent event ID for nested events"
        
      - name: "error_code"
        type: "string"
        description: "Error code if applicable"
        
      - name: "error_message"
        type: "string"
        description: "Error message if applicable"
        
      - name: "additional_data"
        type: "object"
        description: "Event-specific additional data"
        
      - name: "tags"
        type: "array"
        items:
          type: "string"
        description: "Event tags for classification"
        
      - name: "compliance_flags"
        type: "array"
        items:
          type: "string"
          enum: ["soc2", "gdpr", "hipaa", "pci_dss", "iso27001"]
        description: "Applicable compliance frameworks"

  # Event-Specific Schemas
  event_schemas:
    
    # Authentication Events
    authentication_events:
      user_login:
        required_fields:
          - "authentication_method"
          - "login_result"
          - "failure_reason"
        optional_fields:
          - "mfa_used"
          - "device_fingerprint"
          - "geolocation"
        example:
          timestamp: "2024-08-20T14:30:45.123Z"
          event_id: "550e8400-e29b-41d4-a716-446655440000"
          event_type: "authentication"
          event_action: "user_login"
          actor:
            user_id: "user123"
            user_email: "john.doe@whitehorse.ai"
            user_type: "human"
            session_id: "sess_abc123"
          source:
            ip_address: "192.168.1.100"
            user_agent: "Mozilla/5.0..."
            application: "web_portal"
            environment: "prod"
          outcome: "success"
          severity: "info"
          additional_data:
            authentication_method: "saml"
            mfa_used: true
            device_fingerprint: "fp_xyz789"
            
    # Authorization Events  
    authorization_events:
      role_assignment:
        required_fields:
          - "target_user"
          - "role_name"
          - "assignment_type"
        optional_fields:
          - "approval_ticket"
          - "expiration_date"
          - "justification"
        example:
          timestamp: "2024-08-20T14:35:12.456Z"
          event_id: "550e8400-e29b-41d4-a716-446655440001"
          event_type: "authorization"
          event_action: "role_assignment"
          actor:
            user_id: "admin456"
            user_email: "admin@whitehorse.ai"
            user_type: "human"
          resource:
            resource_type: "user_account"
            resource_id: "user789"
            resource_name: "jane.smith@whitehorse.ai"
          outcome: "success"
          severity: "medium"
          additional_data:
            target_user: "user789"
            role_name: "data_analyst"
            assignment_type: "permanent"
            approval_ticket: "TICK-123456"
            justification: "New team member onboarding"
            
    # Data Access Events
    data_access_events:
      sensitive_data_access:
        required_fields:
          - "data_classification"
          - "access_method"
          - "record_count"
        optional_fields:
          - "data_subjects"
          - "purpose"
          - "legal_basis"
        example:
          timestamp: "2024-08-20T14:40:30.789Z"
          event_id: "550e8400-e29b-41d4-a716-446655440002"
          event_type: "data_access"
          event_action: "sensitive_data_access"
          actor:
            user_id: "analyst123"
            user_email: "analyst@whitehorse.ai"
            user_type: "human"
          resource:
            resource_type: "database_table"
            resource_id: "customers_pii"
            resource_name: "Customer Personal Information"
          outcome: "success"
          severity: "high"
          compliance_flags: ["gdpr", "hipaa"]
          additional_data:
            data_classification: "confidential"
            access_method: "sql_query"
            record_count: 150
            purpose: "customer_support"
            legal_basis: "legitimate_interest"
            
    # Infrastructure Events
    infrastructure_events:
      resource_creation:
        required_fields:
          - "cloud_provider"
          - "resource_type"
          - "provisioning_method"
        optional_fields:
          - "terraform_plan"
          - "cost_estimate"
          - "approval_workflow"
        example:
          timestamp: "2024-08-20T15:00:00.000Z"
          event_id: "550e8400-e29b-41d4-a716-446655440003"
          event_type: "infrastructure"
          event_action: "resource_creation"
          actor:
            user_id: "devops123"
            user_email: "devops@whitehorse.ai"
            user_type: "human"
          resource:
            resource_type: "compute_instance"
            resource_id: "vm-web-server-01"
            resource_name: "Production Web Server"
          outcome: "success"
          severity: "medium"
          additional_data:
            cloud_provider: "gcp"
            provisioning_method: "terraform"
            terraform_plan: "plan_abc123"
            cost_estimate: "$150/month"
            approval_workflow: "auto_approved"
            
    # Security Events
    security_events:
      intrusion_attempt:
        required_fields:
          - "attack_type"
          - "threat_level"
          - "affected_systems"
        optional_fields:
          - "attack_signature"
          - "mitigation_actions"
          - "threat_intelligence"
        example:
          timestamp: "2024-08-20T15:15:45.321Z"
          event_id: "550e8400-e29b-41d4-a716-446655440004"
          event_type: "security"
          event_action: "intrusion_attempt"
          source:
            ip_address: "10.0.0.100"
            application: "web_application"
            environment: "prod"
          outcome: "failure"
          severity: "critical"
          additional_data:
            attack_type: "sql_injection"
            threat_level: "high"
            affected_systems: ["web-app-01", "db-primary"]
            attack_signature: "sig_12345"
            mitigation_actions: ["blocked_ip", "waf_rule_applied"]
            
    # Compliance Events
    compliance_events:
      audit_evidence_collection:
        required_fields:
          - "compliance_framework"
          - "control_id"
          - "evidence_type"
        optional_fields:
          - "auditor_id"
          - "collection_method"
          - "evidence_location"
        example:
          timestamp: "2024-08-20T16:00:00.000Z"
          event_id: "550e8400-e29b-41d4-a716-446655440005"
          event_type: "compliance"
          event_action: "audit_evidence_collection"
          actor:
            user_id: "compliance_tool"
            user_type: "system"
          outcome: "success"
          severity: "info"
          compliance_flags: ["soc2"]
          additional_data:
            compliance_framework: "soc2"
            control_id: "CC1.1"
            evidence_type: "configuration_snapshot"
            collection_method: "automated"
            evidence_location: "s3://compliance-evidence/soc2/cc1.1/"

  # Data Classification and Sensitivity
  data_classification:
    levels:
      - name: "public"
        description: "Information that can be freely shared"
        retention_default: "365 days"
        
      - name: "internal"
        description: "Information for internal use only"
        retention_default: "1095 days"
        
      - name: "confidential"
        description: "Sensitive business information"
        retention_default: "2555 days"
        
      - name: "restricted"
        description: "Highly sensitive information requiring special handling"
        retention_default: "2555 days"
        
    personal_data_categories:
      - "basic_identity"        # Name, email, phone
      - "sensitive_identity"    # SSN, passport, driver's license
      - "financial"            # Credit card, bank account, payment info
      - "health"               # Medical records, health data
      - "biometric"            # Fingerprints, facial recognition data
      - "location"             # GPS coordinates, address history
      - "behavioral"           # Browsing history, preferences
      - "professional"         # Employment data, salary information

  # Error Handling and Validation
  validation_rules:
    required_field_validation:
      - "All required fields must be present"
      - "Field types must match schema definitions"
      - "Enum values must be from allowed lists"
      
    data_format_validation:
      - "Timestamps must be valid ISO8601 format"
      - "UUIDs must be valid RFC 4122 format"
      - "IP addresses must be valid IPv4 or IPv6"
      - "Email addresses must be valid RFC 5322 format"
      
    business_rule_validation:
      - "Event timestamps cannot be in the future"
      - "Correlation IDs must reference existing events"
      - "Resource IDs must exist in resource registry"
      - "User IDs must exist in identity system"
      
  # Enrichment and Processing
  enrichment_pipeline:
    geo_enrichment:
      - "IP address geolocation lookup"
      - "Country and region identification"
      - "ISP and organization detection"
      
    threat_intelligence:
      - "Malicious IP identification"
      - "Known attack pattern matching"
      - "Reputation scoring"
      
    user_context:
      - "User profile information"
      - "Role and permission context"
      - "Historical behavior patterns"
      
    resource_context:
      - "Resource metadata lookup"
      - "Ownership and classification"
      - "Dependency relationships"

  # Output Formats
  serialization_formats:
    json:
      content_type: "application/json"
      encoding: "UTF-8"
      compression: "gzip"
      
    syslog:
      rfc: "RFC 5424"
      facility: "LOG_USER"
      severity_mapping:
        critical: "LOG_CRIT"
        high: "LOG_ERR"
        medium: "LOG_WARNING"
        low: "LOG_NOTICE"
        info: "LOG_INFO"
        
    cef:
      version: "CEF:0"
      device_vendor: "Whitehorse"
      device_product: "Universal Platform"
      device_version: "1.0.0"

# Sample Complete Event
sample_event:
  timestamp: "2024-08-20T14:30:45.123Z"
  event_id: "550e8400-e29b-41d4-a716-446655440000"
  event_type: "data_access"
  event_action: "sensitive_data_export"
  correlation_id: "req_abc123def456"
  actor:
    user_id: "user123"
    user_email: "analyst@whitehorse.ai"
    user_type: "human"
    session_id: "sess_xyz789"
  resource:
    resource_type: "database_table"
    resource_id: "customers_pii"
    resource_name: "Customer Personal Information"
  source:
    ip_address: "192.168.1.100"
    user_agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
    application: "data_analytics_portal"
    environment: "prod"
  outcome: "success"
  severity: "high"
  compliance_flags: ["gdpr", "soc2"]
  tags: ["data_export", "customer_data", "analytics"]
  additional_data:
    data_classification: "confidential"
    export_format: "csv"
    record_count: 5000
    data_subjects_affected: 5000
    purpose: "quarterly_analysis"
    legal_basis: "legitimate_interest"
    approval_ticket: "EXP-2024-0820-001"
    retention_period: "90_days"
    export_location: "s3://analytics-exports/q3-2024/customer-analysis.csv"