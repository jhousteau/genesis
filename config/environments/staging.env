# Genesis Staging Environment Configuration
# This file contains environment-specific settings for staging/pre-production

# Environment identifier
ENVIRONMENT="staging"
ENVIRONMENT_TYPE="staging"

# GCP Configuration
PROJECT_ID="${PROJECT_ID_STAGING:-whai-genesis-staging}"
REGION="us-central1"
ZONE="us-central1-a"

# Resource naming suffix
RESOURCE_SUFFIX="staging"

# Network Configuration
SUBNET_CIDR="10.30.0.0/24"
SECONDARY_RANGE_PODS="10.31.0.0/16"
SECONDARY_RANGE_SERVICES="10.32.0.0/20"

# Compute Configuration
MACHINE_TYPE="e2-standard-4"
USE_PREEMPTIBLE=false  # More stable than dev, less expensive than prod
ENABLE_PUBLIC_IP=false
MAX_INSTANCES=20

# GKE Configuration
GKE_NODE_COUNT=3
GKE_MIN_NODES=2
GKE_MAX_NODES=10
GKE_MACHINE_TYPE="e2-standard-4"
ENABLE_AUTOPILOT=false
ENABLE_WORKLOAD_IDENTITY=true
ENABLE_PRIVATE_CLUSTER=true

# Storage Configuration
DISK_SIZE=200
DISK_TYPE="pd-balanced"  # Balanced performance/cost
BOOT_DISK_SIZE=30
ENABLE_BACKUPS=true
BACKUP_RETENTION_DAYS=30

# Database Configuration
DB_TIER="db-n1-standard-2"
DB_VERSION="POSTGRES_14"
DB_BACKUP_ENABLED=true
DB_HIGH_AVAILABILITY=true  # Test HA before production
DB_STORAGE_SIZE=100
DB_STORAGE_AUTO_INCREASE=true

# Cost Management
MONTHLY_BUDGET=1000
ALERT_THRESHOLD_PERCENT=80
AUTO_SHUTDOWN_HOURS=0  # Keep running for testing
ENABLE_AUTO_SHUTDOWN=false

# Security Configuration
ENABLE_PRIVATE_GOOGLE_ACCESS=true
ENABLE_FLOW_LOGS=true
ENABLE_CLOUD_ARMOR=true  # Test security features
ENABLE_CLOUD_NAT=true
ENABLE_BINARY_AUTHORIZATION=true
ENABLE_VULNERABILITY_SCANNING=true

# Monitoring Configuration
LOG_RETENTION_DAYS=30
METRIC_RETENTION_DAYS=90
ENABLE_MONITORING=true
ENABLE_LOGGING=true
ENABLE_TRACING=true
ENABLE_PROFILING=true
ENABLE_ERROR_REPORTING=true
ENABLE_UPTIME_CHECKS=true

# Staging Features
ENABLE_HOT_RELOAD=false
ENABLE_DEBUG=false
ENABLE_VERBOSE_LOGGING=false
ENABLE_DEV_TOOLS=false

# CI/CD Configuration
ENABLE_CI_CD=true
CI_BRANCH_PATTERN="staging|release/*"
DEPLOY_ON_PUSH=false  # Manual or scheduled
RUN_TESTS_ON_COMMIT=true
REQUIRE_APPROVAL=true
MIN_APPROVALS=1

# Resource Limits
MAX_CPU_PER_CONTAINER="4"
MAX_MEMORY_PER_CONTAINER="8Gi"
MAX_STORAGE_PER_VOLUME="500Gi"

# Service URLs (staging)
API_URL="https://api-staging.genesis.com"
WEB_URL="https://staging.genesis.com"
MONITORING_URL="https://monitoring-staging.genesis.com"

# External integrations (staging)
SLACK_WEBHOOK_URL="${SLACK_WEBHOOK_URL_STAGING}"
PAGERDUTY_INTEGRATION_KEY=""  # Optional for staging
GITHUB_WEBHOOK_SECRET="${GITHUB_WEBHOOK_SECRET_STAGING}"

# Feature flags
FEATURE_NEW_UI=true  # Test new features
FEATURE_ADVANCED_MONITORING=true
FEATURE_EXPERIMENTAL=false

# Scaling Configuration
MIN_REPLICAS=2
MAX_REPLICAS=15
TARGET_CPU_UTILIZATION=65
ENABLE_HORIZONTAL_POD_AUTOSCALING=true
ENABLE_VERTICAL_POD_AUTOSCALING=false
ENABLE_CLUSTER_AUTOSCALING=true

# Staging safeguards
REQUIRE_STAGING_CONFIRMATION=false
ENABLE_DELETION_PROTECTION=true
ENABLE_RESOURCE_LOCKS=false

# Cache Configuration
REDIS_ENABLED=true
REDIS_SIZE="5GB"
REDIS_HIGH_AVAILABILITY=false
MEMCACHED_ENABLED=true
MEMCACHED_SIZE="2GB"

# Queue Configuration
PUBSUB_ENABLED=true
MAX_QUEUE_SIZE=50000
WORKER_COUNT=5
ENABLE_DEAD_LETTER_QUEUE=true

# Secrets Management
USE_SECRET_MANAGER=true
SECRET_ROTATION_DAYS=60

# Compliance
REQUIRE_ENCRYPTION_AT_REST=true
REQUIRE_ENCRYPTION_IN_TRANSIT=true
AUDIT_LOGGING_ENABLED=true
ENABLE_ACCESS_TRANSPARENCY=false
COMPLIANCE_STANDARDS="SOC2"

# Performance Testing
ENABLE_LOAD_TESTING=true
ENABLE_STRESS_TESTING=true
ENABLE_CHAOS_ENGINEERING=false

# Terraform State
TF_STATE_BUCKET="tf-state-whai-genesis-staging"
TF_STATE_PREFIX="genesis/staging"
TF_STATE_ENCRYPTION=true
TF_STATE_VERSIONING=true

# Container Registry
CONTAINER_REGISTRY="us-central1-docker.pkg.dev"
ARTIFACT_REPOSITORY="whai-genesis-staging/containers"
ENABLE_VULNERABILITY_SCANNING=true

# Tags and Labels
DEFAULT_LABELS="environment=staging,project=genesis,managed-by=terraform"
DEFAULT_TAGS="whai-genesis-staging"

# Notification Settings
ALERT_EMAIL="${STAGING_ALERT_EMAIL}"
ALERT_SMS=""  # Optional for staging

# SLA Configuration (testing production SLAs)
TARGET_UPTIME="99.5"
ERROR_BUDGET_PERCENT="0.5"

# Maintenance Windows
MAINTENANCE_WINDOW_DAY="saturday"
MAINTENANCE_WINDOW_HOUR="02"
MAINTENANCE_WINDOW_DURATION="4"

# Export environment type for scripts
export ENVIRONMENT_TYPE
